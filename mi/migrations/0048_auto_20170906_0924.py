# -*- coding: utf-8 -*-
# Generated by Django 1.11.3 on 2017-09-06 09:24
from __future__ import unicode_literals

from django.db import migrations


def target_country_correction(apps, schema_editor):
    Target = apps.get_model('mi', 'Target')
    FinancialYear = apps.get_model('mi', 'FinancialYear')
    Country = apps.get_model('mi', 'Country')
    TargetCountry = apps.get_model('mi', 'TargetCountry')
    hvc_corrections = [['E042', ['TZ']], ['E241', ['BR']]]
    financial_year = FinancialYear.objects.get(id=2017)
    for item in hvc_corrections:
        hvc = item[0]
        if Target.objects.filter(campaign_id=hvc, financial_year=financial_year).exists():
            target = Target.objects.get(campaign_id=hvc, financial_year=financial_year)
            for country_code in item[1]:
                # skip entries without country codes
                if country_code != '' and country_code != 'XG':
                    country = Country.objects.get(country=country_code)
                    TargetCountry(target=target, country=country).save()


def add_contributing_countries(apps, schema_editor):
    hvc_2016 = [('E008', 'BH', 2016),
                ('E012', 'BR', 2016),
                ('E013', 'BR', 2016),
                ('E014', 'BR', 2016),
                ('E017', 'HU', 2016),
                ('E018', 'PL', 2016),
                ('E020', 'RO', 2016),
                ('E023', 'CN', 2016),
                ('E024', 'CN', 2016),
                ('E026', 'CN', 2016),
                ('E027', 'CN', 2016),
                ('E028', 'CN', 2016),
                ('E030', 'CN', 2016),
                ('E031', 'CN', 2016),
                ('E032', 'CN', 2016),
                ('E033', 'CN', 2016),
                ('E035', 'CN', 2016),
                ('E037', 'CN', 2016),
                ('E039', 'CN', 2016),
                ('E040', 'DK', 2016),
                ('E041', 'KE', 2016),
                ('E042', 'TZ', 2016),
                ('E044', 'FI', 2016),
                ('E045', 'FR', 2016),
                ('E047', 'FR', 2016),
                ('E050', 'DE', 2016),
                ('E051', 'DE', 2016),
                ('E053', 'DE', 2016),
                ('E054', 'DE', 2016),
                ('E056', 'GH', 2016),
                ('E058', 'HK', 2016),
                ('E060', 'HK', 2016),
                ('E061', 'HK', 2016),
                ('E063', 'IN', 2016),
                ('E064', 'IN', 2016),
                ('E065', 'IN', 2016),
                ('E067', 'IN', 2016),
                ('E068', 'IN', 2016),
                ('E070', 'IN', 2016),
                ('E071', 'IN', 2016),
                ('E072', 'IN', 2016),
                ('E073', 'IN', 2016),
                ('E074', 'IN', 2016),
                ('E075', 'IN', 2016),
                ('E076', 'IN', 2016),
                ('E077', 'IN', 2016),
                ('E078', 'ID', 2016),
                ('E079', 'ID', 2016),
                ('E081', 'IQ', 2016),
                ('E083', 'IT', 2016),
                ('E084', 'JP', 2016),
                ('E086', 'JP', 2016),
                ('E087', 'JP', 2016),
                ('E088', 'JP', 2016),
                ('E090', 'JP', 2016),
                ('E091', 'KZ', 2016),
                ('E092', 'KW', 2016),
                ('E094', 'BR', 2016),
                ('E095', 'BR', 2016),
                ('E099', 'MX', 2016),
                ('E103', 'MY', 2016),
                ('E105', 'IT', 2016),
                ('E106', 'ES', 2016),
                ('E107', 'MX', 2016),
                ('E111', 'AE', 2016),
                ('E112', 'SA', 2016),
                ('E114', 'DK', 2016),
                ('E116', 'SE', 2016),
                ('E117', 'NG', 2016),
                ('E118', 'US', 2016),
                ('E121', 'NO', 2016),
                ('E122', 'OM', 2016),
                ('E123', 'OM', 2016),
                ('E126', 'PH', 2016),
                ('E127', 'PT', 2016),
                ('E130', 'QA', 2016),
                ('E131', 'SA', 2016),
                ('E135', 'SA', 2016),
                ('E136', 'SA', 2016),
                ('E138', 'SA', 2016),
                ('E139', 'SG', 2016),
                ('E140', 'SG', 2016),
                ('E142', 'SG', 2016),
                ('E143', 'SG', 2016),
                ('E144', 'ZA', 2016),
                ('E145', 'ZA', 2016),
                ('E146', 'MY', 2016),
                ('E147', 'SG', 2016),
                ('E149', 'KR', 2016),
                ('E152', 'KR', 2016),
                ('E154', 'ZA', 2016),
                ('E155', 'ES', 2016),
                ('E156', 'ES', 2016),
                ('E158', 'SE', 2016),
                ('E160', 'SE', 2016),
                ('E163', 'TH', 2016),
                ('E166', 'TR', 2016),
                ('E168', 'TR', 2016),
                ('E171', 'UA', 2016),
                ('E173', 'AE', 2016),
                ('E174', 'AE', 2016),
                ('E175', 'AE', 2016),
                ('E176', 'AE', 2016),
                ('E178', 'AE', 2016),
                ('E179', 'AE', 2016),
                ('E180', 'AE', 2016),
                ('E181', 'AE', 2016),
                ('E182', 'US', 2016),
                ('E185', 'US', 2016),
                ('E187', 'US', 2016),
                ('E194', 'US', 2016),
                ('E209', 'TN', 2016),
                ('E211', 'KZ', 2016),
                ('E212', 'TW', 2016),
                ('E214', 'FR', 2016),
                ('E003', 'AU', 2016),
                ('E004', 'AU', 2016),
                ('E005', 'AU', 2016),
                ('E006', 'AU', 2016),
                ('E007', 'AZ', 2016),
                ('E010', 'BE', 2016),
                ('E015', 'CA', 2016),
                ('E019', 'PL', 2016),
                ('E022', 'CN', 2016),
                ('E029', 'CN', 2016),
                ('E038', 'CN', 2016),
                ('E043', 'KE', 2016),
                ('E046', 'FR', 2016),
                ('E055', 'DE', 2016),
                ('E062', 'IN', 2016),
                ('E066', 'IN', 2016),
                ('E069', 'IN', 2016),
                ('E085', 'JP', 2016),
                ('E089', 'JP', 2016),
                ('E093', 'KW', 2016),
                ('E098', 'CL', 2016),
                ('E100', 'CO', 2016),
                ('E102', 'MY', 2016),
                ('E109', 'MX', 2016),
                ('E115', 'DK', 2016),
                ('E119', 'NL', 2016),
                ('E132', 'SA', 2016),
                ('E133', 'SA', 2016),
                ('E141', 'SG', 2016),
                ('E150', 'KR', 2016),
                ('E151', 'KR', 2016),
                ('E161', 'CH', 2016),
                ('E162', 'TH', 2016),
                ('E167', 'TR', 2016),
                ('E170', 'UA', 2016),
                ('E183', 'US', 2016),
                ('E184', 'US', 2016),
                ('E188', 'US', 2016),
                ('E189', 'US', 2016),
                ('E190', 'US', 2016),
                ('E213', 'IR', 2016),
                ('E001', 'AU', 2016),
                ('E195', 'BS', 2016),
                ('E002', 'AU', 2016),
                ('E009', 'LT', 2016),
                ('E011', 'BE', 2016),
                ('E016', 'CA', 2016),
                ('E021', 'CL', 2016),
                ('E025', 'CN', 2016),
                ('E034', 'CN', 2016),
                ('E048', 'FR', 2016),
                ('E049', 'DE', 2016),
                ('E052', 'DE', 2016),
                ('E059', 'HK', 2016),
                ('E080', 'IQ', 2016),
                ('E082', 'IQ', 2016),
                ('E096', 'MX', 2016),
                ('E097', 'BR', 2016),
                ('E101', 'BR', 2016),
                ('E104', 'MY', 2016),
                ('E108', 'MX', 2016),
                ('E110', 'MX', 2016),
                ('E120', 'NO', 2016),
                ('E124', 'PH', 2016),
                ('E125', 'PH', 2016),
                ('E128', 'PT', 2016),
                ('E129', 'QA', 2016),
                ('E134', 'SA', 2016),
                ('E137', 'SA', 2016),
                ('E148', 'KR', 2016),
                ('E153', 'ZA', 2016),
                ('E157', 'SE', 2016),
                ('E159', 'SE', 2016),
                ('E164', 'TH', 2016),
                ('E165', 'TR', 2016),
                ('E169', 'TR', 2016),
                ('E172', 'AE', 2016),
                ('E177', 'AE', 2016),
                ('E186', 'US', 2016),
                ('E191', 'US', 2016),
                ('E192', 'US', 2016),
                ('E210', 'MN', 2016),
                ('E217', 'MA', 2016),
                ('E215', '', 2016)]
    hvc_2017 = [
        ['E002', ['AU', 'NZ']], 
        ['E005', ['AU', 'NZ']], 
        ['E006', ['AU']], 
        ['E007', ['AZ']], 
        ['E008', ['BH']], 
        ['E009', ['LT', 'EE', 'LV']], 
        ['E011', ['BE', 'NL', 'LU']], 
        ['E012', ['BR']], 
        ['E013', ['BR']], 
        ['E014', ['BR']], 
        ['E015', ['CA']], 
        ['E016', ['CA']], 
        ['E017', ['HU', 'CZ', 'PL', 'RO', 'SK', 'BG', 'RS']], 
        ['E018', ['PL', 'CZ', 'RO', 'SK', 'BG']], 
        ['E019', ['PL', 'BG', 'CZ', 'RO', 'RS', 'SK']], 
        ['E020', ['RO', 'BG', 'CZ', 'HU', 'PL', 'SK', 'SI']], 
        ['E021', ['CL']], 
        ['E022', ['CN']], 
        ['E023', ['CN']], 
        ['E024', ['CN']], 
        ['E025', ['CN']], 
        ['E026', ['CN']], 
        ['E027', ['CN']], 
        ['E028', ['CN']], 
        ['E029', ['CN']], 
        ['E030', ['CN']], 
        ['E031', ['CN', 'HK']], 
        ['E032', ['CN']], 
        ['E033', ['CN', 'HK']], 
        ['E034', ['CN']], 
        ['E035', ['CN']], 
        ['E037', ['CN']], 
        ['E038', ['CN', 'HK']], 
        ['E040', ['DK']], 
        ['E041', ['KE', 'ET', 'TN', 'UG']], 
        ['E042', ['TZ', 'UG', 'MZ']], 
        ['E043', ['KE', 'ET', 'TN', 'UG']], 
        ['E044', ['FI']], 
        ['E045', ['FR']], 
        ['E046', ['FR']], 
        ['E047', ['FR']], 
        ['E049', ['DE']], 
        ['E050', ['DE', 'AT', 'CH']], 
        ['E051', ['DE']], 
        ['E052', ['DE']], 
        ['E053', ['DE', 'SE']], 
        ['E054', ['DE', 'FR', 'IE', 'CH']], 
        ['E055', ['DE', 'CH', 'AT']], 
        ['E056', ['GH', 'GN', 'ZM', "CI", 'AO', 'TN']], 
        ['E058', ['HK']], 
        ['E059', ['HK']], 
        ['E061', ['HK', 'TW']], 
        ['E063', ['IN']], 
        ['E064', ['IN']], 
        ['E065', ['IN']], 
        ['E066', ['IN']], 
        ['E067', ['IN']], 
        ['E068', ['IN']], 
        ['E069', ['IN']], 
        ['E070', ['IN']], 
        ['E071', ['IN']], 
        ['E072', ['IN']], 
        ['E073', ['IN']], 
        ['E074', ['IN']], 
        ['E075', ['IN']], 
        ['E076', ['IN']], 
        ['E078', ['ID']], 
        ['E079', ['ID']], 
        ['E081', ['IQ']], 
        ['E083', ['IT']], 
        ['E085', ['JP']], 
        ['E086', ['JP']], 
        ['E087', ['JP']], 
        ['E089', ['JP']], 
        ['E091', ['KZ']], 
        ['E092', ['KW']], 
        ['E094', ['BR', 'CO', 'MX', 'EC', 'PA']], 
        ['E095', ['BR', 'CO', 'MX', 'VE']], 
        ['E096', ['MX', 'BR', 'CL', 'AR', 'DO', 'EC', 'PY']], 
        ['E097', ['BR', 'MX', 'PE', 'CO', 'CL']], 
        ['E098', ['CL', 'AR', 'BR', 'PE', 'MX', 'EC', 'CO']], 
        ['E099', ['MX', 'AR', 'CO', 'VE']], 
        ['E100', ['CO', 'AR', 'PA', 'PE', 'BR', 'CR']], 
        ['E103', ['MY']], 
        ['E104', ['MY']], 
        ['E105', ['IT', 'PT', 'ES', 'GR', 'CY']], 
        ['E106', ['ES', 'CY', 'GR', 'IL', 'IT', 'PT']], 
        ['E107', ['MX']], 
        ['E108', ['MX']], 
        ['E110', ['MX', 'BR', 'AR', 'CR']], 
        ['E111', ['AE', 'BH', 'KW', 'QA', 'OM', 'SA']], 
        ['E112', ['AE', 'SA']], 
        ['E116', ['DK', 'SE', 'NO', 'FI', 'EE', 'LV', 'LT']], 
        ['E117', ['NG']], 
        ['E118', ['US', 'CA']], 
        ['E119', ['NL', 'BE', 'FR', 'DE']], 
        ['E120', ['NO']], 
        ['E121', ['NO']], 
        ['E122', ['OM']], 
        ['E123', ['OM']], 
        ['E124', ['PH']], 
        ['E125', ['PH']], 
        ['E128', ['PT']], 
        ['E129', ['QA']], 
        ['E132', ['SA']], 
        ['E133', ['SA']], 
        ['E135', ['SA']], 
        ['E137', ['SA']], 
        ['E138', ['SA']], 
        ['E140', ['SG']], 
        ['E141', ['SG']], 
        ['E143', ['SG']], 
        ['E145', ['ZA', 'BW']], 
        ['E146', ['MY', 'VN', 'TH', 'ID', 'MM', 'PH', 'KH']], 
        ['E147', ['SG', 'MY', 'TH', 'ID', 'VN']], 
        ['E148', ['KR']], 
        ['E149', ['KR']], 
        ['E150', ['KR']], 
        ['E151', ['KR']], 
        ['E152', ['KR']], 
        ['E153', ['ZA', 'AO', 'ET', 'ZM', 'NG', 'UG', 'TN']], 
        ['E154', ['ZA', 'GH', 'MZ', 'NA', 'NG', 'CM', 'ZM']], 
        ['E155', ['ES']], 
        ['E156', ['ES']], 
        ['E158', ['SE']], 
        ['E159', ['SE']], 
        ['E161', ['CH', 'US', 'DK']], 
        ['E163', ['TH']], 
        ['E164', ['TH']], 
        ['E165', ['TR']], 
        ['E166', ['TR']], 
        ['E167', ['TR']], 
        ['E168', ['TR']], 
        ['E170', ['UA']], 
        ['E171', ['UA']], 
        ['E174', ['AE']], 
        ['E175', ['AE']], 
        ['E179', ['AE', 'KW']], 
        ['E182', ['US']], 
        ['E183', ['US', 'TN', 'UG', 'KE', 'MM', 'PH', 'GH']], 
        ['E184', ['US']], 
        ['E185', ['US']], 
        ['E186', ['US']], 
        ['E187', ['US', 'CA']], 
        ['E188', ['US']], 
        ['E189', ['US']], 
        ['E191', ['US']], 
        ['E192', ['US', 'CA', 'MX']], 
        ['E194', ['US']], 
        ['E209', ['TN', 'LY', 'EG']], 
        ['E210', ['MN']], 
        ['E211', ['KZ']], 
        ['E212', ['TW']], 
        ['E215', ['']], 
        ['E217', ['MA']], 
        ['E218', ['AT']], 
        ['E219', ['CZ', 'BG', 'RO', 'BA', 'SK', 'HR', 'HU']], 
        ['E220', ['CZ', 'PL', 'RO', 'BG', 'SK']], 
        ['E221', ['BG', 'PL', 'RS', 'BA']], 
        ['E222', ['PL', 'BG', 'CZ', 'HU', 'RO', 'SI']], 
        ['E223', ['CO']], 
        ['E224', ['XG']], 
        ['E225', ['XG', 'QA', 'JP', 'CN', 'PE', 'ID', 'FR']], 
        ['E226', ['XG', 'CN', 'IN', 'HK']], 
        ['E227', ['IN']], 
        ['E228', ['ID']], 
        ['E229', ['IR']], 
        ['E230', ['BR', 'MX', 'PA', 'CU', 'PE']], 
        ['E231', ['SA', 'AE', 'KW', 'OM', 'BH']], 
        ['E232', ['AE', 'SA', 'KW', 'QA', 'OM']], 
        ['E233', ['FI', 'DK', 'NO', 'SE', 'IS']], 
        ['E234', ['']], 
        ['E236', ['SG', 'TH']], 
        ['E237', ['ES']], 
        ['E238', ['CH']], 
        ['E239', ['AT', 'CH', 'NL']], 
        ['E241', ['BR', 'AR', 'MX', 'CO']],]
    TargetCountry = apps.get_model('mi', 'TargetCountry')
    Target = apps.get_model('mi', 'Target')
    FinancialYear = apps.get_model('mi', 'FinancialYear')
    Country = apps.get_model('mi', 'Country')
    # update 2016 targets
    financial_year_16 = FinancialYear.objects.get(id=2016)
    for item in hvc_2016:
        hvc, country_code, fy = item
        # skip entries without country codes
        if country_code != '':
            country = Country.objects.get(country=country_code)
            if Target.objects.filter(campaign_id=hvc, financial_year=financial_year_16).exists():
                target = Target.objects.get(campaign_id=hvc, financial_year=financial_year_16)
                target_country = TargetCountry.objects.get(target=target, country=country)
                target_country.contributes_to_target = True
                target_country.save()
    # update 2017 targets
    financial_year_17 = FinancialYear.objects.get(id=2017)
    for item in hvc_2017:
        hvc = item[0]
        if Target.objects.filter(campaign_id=hvc, financial_year=financial_year_17).exists():
            target = Target.objects.get(campaign_id=hvc, financial_year=financial_year_17)
            country_code = item[1][0]   # we are only interested in primary market, which is first one
            # skip entries without country codes and globals
            if country_code != '' and country_code != 'XG':
                country = Country.objects.get(country=country_code)
                target_country = TargetCountry.objects.get(target=target, country=country)
                target_country.contributes_to_target = True
                target_country.save()


class Migration(migrations.Migration):

    dependencies = [
        ('mi', '0047_auto_20170905_1623'),
    ]

    operations = [
        migrations.RunPython(target_country_correction),
        migrations.RunPython(add_contributing_countries),
    ]
